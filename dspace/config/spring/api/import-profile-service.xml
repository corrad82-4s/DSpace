<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:util="http://www.springframework.org/schema/util"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd"
       default-lazy-init="true">

    <bean id="importResearcherProfile" class="org.dspace.app.profile.ImportResearcherProfileServiceImpl">
        <constructor-arg name="externalDataService" ref="importProfileExternalDataService"/>
        <constructor-arg name="installItemService" ref="org.dspace.content.InstallItemServiceImpl"/>
        <constructor-arg name="requestService" ref="org.dspace.services.RequestService"/>

        <property name="afterImportActionList">
            <list>
                <ref bean="dspaceAfterImportAction"/>
                <ref bean="profileItemCloningAction"/>
            </list>
        </property>
    </bean>

    <bean id="importProfileExternalDataService" class="org.dspace.external.service.impl.ExternalDataServiceImpl">
        <property name="externalDataProviders">
            <list>
                <ref bean="dspaceLiveImportDataProvider"/>
            </list>
        </property>
    </bean>

    <bean id="dspaceLiveImportDataProvider" class="org.dspace.external.provider.impl.LiveImportDataProvider">
        <property name="metadataSource" ref="dspaceImportService"/>
        <property name="sourceIdentifier" value="dspace"/>
        <property name="recordIdMetadata" value="dc.identifier"/>
        <property name="supportedEntityTypes">
            <list>
                <value>CvPerson</value>
            </list>
        </property>
    </bean>

    <bean id="dspaceImportService" class="org.dspace.importer.external.dspace.DSpaceImportService"/>

    <bean id="dspaceInternalMetadataFieldMapping"
          class="org.dspace.importer.external.dspace.DSpaceInternalMetadataFieldMapping">
        <property name="identifierMetadata" value="dc.identifier"/>
    </bean>

    <bean id="dspaceAfterImportAction" class="org.dspace.importer.external.dspace.DspaceAfterImportAction">

        <constructor-arg name="dSpaceItemRelationshipService" ref="dspaceItemRelationshipService"/>
    </bean>
    
    <bean id="profileItemCloningAction" class="org.dspace.importer.external.dspace.ProfileItemCloningAction" />

    <bean id="dspaceItemRelationshipService" class="org.dspace.importer.external.dspace.DSpaceItemRelationshipService">

        <property name="leftEntityType" value="CvPerson"/>
        <property name="rightEntityType" value="Person"/>
        <property name="leftwardType" value="isPersonOwner"/>
        <property name="rightwardType" value="isOwnedByCvPerson"/>
    </bean>

    <bean id="removeRelationAction" class="org.dspace.importer.external.dspace.RemoveDSpaceRelationAction"/>
    
    <util:map id="profileSynchronizationMap" map-class="java.util.HashMap" key-type="java.lang.String" value-type="java.util.List"> 
	   <entry key="perucris.cvPerson.syncEducation" >
	       <list>
	           <value>crisrp.education</value>
               <value>crisrp.education.start</value>
               <value>crisrp.education.end</value>
               <value>crisrp.education.role</value>
               <value>perucris.education.grantor</value>
               <value>perucris.education.country</value>
	       </list>
	   </entry>
	</util:map>
    

    <!-- TODO: set orcid import -->

</beans>

